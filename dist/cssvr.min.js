/*! cssvr v1.0.0 - Keith Clark - MIT license */
var CSSVR=function(a){'use strict';function b(a){y=a.pageX,z=a.pageY,window.addEventListener('mousemove',this.mouseMoveHandler),window.addEventListener('mouseup',this.mouseUpHandler)}function c(a){let b=a.pageX-y,c=a.pageY-z;b/=5,c/=5,this.rotation.x+=c,this.rotation.y-=b,this.rotation.x=Math.max(-90,Math.min(90,this.rotation.x)),y=a.pageX,z=a.pageY}function d(){window.removeEventListener('mousemove',this.mouseMoveHandler),window.removeEventListener('mouseup',this.mouseUpHandler)}function e(a){a.preventDefault()}function f(a){if(a.alpha||a.beta||a.gamma){let b=B(a.alpha,a.beta,a.gamma);this.rotation.x=b.elevation,this.rotation.y=b.heading,this.rotation.z=b.tilt}}var g=Math.tan,h=Math.PI,i=Math.sin,j=Math.cos,k=Math.sqrt;class l{constructor(a=0,b=0,c=0){this.set(a,b,c)}set(a,b,c){return this.x=a,this.y=b,this.z=c,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}mul(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}divs(a){return this.x/=a,this.y/=a,this.z/=a,this}muls(a){return this.x*=a,this.y*=a,this.z*=a,this}cross(a){let b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}length(){return k(this.x*this.x+this.y*this.y+this.z*this.z)}clone(){return new l(this.x,this.y,this.z)}normalize(){return this.divs(this.length()),this}rotate(a,b){b&&this.sub(b);let c=this.x,d=this.y,e=this.z,f=a.x/2,g=a.y/2,h=a.z/2,k=j(f),l=j(g),m=j(h),n=i(f),o=i(g),p=i(h),q=k*l*m+-n*o*-p,r=n*l*m- -k*o*-p,s=k*o*m+n*l*p,t=k*l*p- -n*o*-m;return this.x=c*(1-2*(s*s+t*t))+d*(2*(r*s-t*q))+e*(2*(r*t+s*q)),this.y=c*(2*(r*s+t*q))+d*(1-2*(r*r+t*t))+e*(2*(s*t-r*q)),this.z=c*(2*(r*t-s*q))+d*(2*(t*s+r*q))+e*(1-2*(r*r+s*s)),b&&this.add(b),this}static fromCssValueString(a){let b=a.split(/px\s*/);return new l(+b[0],+b[1],+b[2])}}const m=h/180,n=180/h,o=1e-6;class p{constructor(a,b){this.origin=a,this.direction=b}getFaceIntersectionDistance(a){let b=this.getTriangleIntersectionDistance(a.a,a.b,a.c);return b||(b=this.getTriangleIntersectionDistance(a.a,a.c,a.d)),b}getFaceIntersectionPoint(){let a=this.getFaceIntersectionDistance();if(a)return this.direction.clone().muls(a).add(this.origin)}intersectsFace(){return!!this.getFaceIntersectionDistance}getTriangleIntersectionDistance(a,b,c){let d=this.direction,e=b.clone().sub(a),f=c.clone().sub(a),g=d.clone().cross(f),h=e.dot(g);if(h>-o&&h<o)return null;let i=1/h,j=this.origin.clone().sub(a),k=j.dot(g)*i;if(0>k||1<k)return null;let l=j.clone().cross(e),m=d.dot(l)*i;if(0>m||1<k+m)return null;let n=f.dot(l)*i;return n>o?n:null}}var q=class{constructor(){this.rotation=new l,this.position=new l}translate(a){this.position.add(a)}rotate(a){this.rotation.add(a)}};class r{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){let q=this.elements;q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p}decompose(){var a=Math.atan2;let b=this.elements,c=b[3],d=b[7],e=b[11],f=a(b[9],b[10]),g=Math.asin(-b[8]),h=a(b[4],b[0]);return{rotate:new l(f,g,h),translate:new l(c,d,e)}}static fromCssMatrixString(a){let b=a.split(/\s*[(),]\s*/).slice(1,-1),c=new r;return 6===b.length?c.set(+b[0],+b[1],0,0,+b[2],+b[3],0,0,0,0,1,0,+b[4],+b[5],0,1):16===b.length&&c.set(+b[0],+b[1],+b[2],+b[3],+b[4],+b[5],+b[6],+b[7],+b[8],+b[9],+b[10],+b[11],+b[12],+b[13],+b[14],+b[15]),c}}class s extends q{constructor(e,a,b,c){super(),this.a=e||new l,this.b=a||new l,this.c=b||new l,this.d=c||new l,this.normal=new l(0,0,1),this.origin=new l,this.canInteract=!0}translate(a){super.translate(a),this.a.add(a),this.b.add(a),this.c.add(a),this.d.add(a)}rotate(a,b){super.rotate(a),this.a.rotate(a,b),this.b.rotate(a,b),this.c.rotate(a,b),this.d.rotate(a,b),this.normal.rotate(a)}clone(){let a=new s;return a.a.set(this.a.x,this.a.y,this.a.z),a.b.set(this.b.x,this.b.y,this.b.z),a.c.set(this.c.x,this.c.y,this.c.z),a.d.set(this.d.x,this.d.y,this.d.z),a.origin.set(this.origin.x,this.origin.y,this.origin.z),a.position.set(this.position.x,this.position.y,this.position.z),a.rotation.set(this.rotation.x,this.rotation.y,this.rotation.z),a.canInteract=this.canInteract,a}setFromElement(a){let b=a.offsetTop,c=a.offsetLeft,d=c+a.offsetWidth,e=b+a.offsetHeight,f=getComputedStyle(a),g=f.transform,h=f.transformOrigin,i='none'!==f.pointerEvents,j=l.fromCssValueString(h),k=r.fromCssMatrixString(g),m=k.decompose();this.canInteract=i,this.a.set(c,b,0),this.b.set(d,b,0),this.c.set(d,e,0),this.d.set(c,e,0),this.origin=j,(m.rotate.x||m.rotate.y||m.rotate.z)&&this.rotate(m.rotate,j),this.translate(m.translate)}static fromElement(a){let b=new s;return b.setFromElement(a),b}}var t=class extends q{constructor(){super(),this.fov=70}};const u=250;class v{constructor(a){let b=document.createElement('div'),c=document.createElement('div'),d=document.createElement('div'),e=document.createElement('div'),f=document.createElement('div');this._root=a,this.rootElement=b,this.cameraElement=e,this.viewportElement=d,this.cursorElement=f,b.className='vr',c.className='vr__eye',d.className='vr__viewport',e.className='vr__camera',f.className='vr__cursor',d.appendChild(e),c.appendChild(d),c.appendChild(f),b.appendChild(c)}addNodesToViewport(){for(;this._root.hasChildNodes();)this.cameraElement.appendChild(this._root.firstChild)}removeNodesFromViewport(){for(;this.cameraElement.hasChildNodes();)this._root.appendChild(this.cameraElement.firstChild)}enable(){return this._root.style.display='none',this.addNodesToViewport(),this._root.appendChild(this.rootElement),new Promise((a)=>{setTimeout(()=>{this._root.style.display='',a()},u)})}disable(){return this._root.style.display='none',this._root.removeChild(this.rootElement),this.removeNodesFromViewport(),new Promise((a)=>{setTimeout(()=>{this._root.style.display='',a()},u)})}update(a){let b=0|window.innerWidth/2/g(a.fov/2/180*h),c=`translate3d(-50%,-50%,${b-b/10}px)`+`rotateZ(${a.rotation.z}deg)`+`rotateX(${a.rotation.x}deg)`+`rotateY(${a.rotation.y}deg)`+`translate3d(${-a.position.x}px,${-a.position.y}px,${-a.position.z}px)`;this.cameraElement.style.transform=c,this.viewportElement.style.perspective=b+'px'}}class w extends v{constructor(a){super(a),this._separation=6.4}_inputSyncHandler(){this.rightNode.value=this.value,this.rightNode.checked=this.checked}get separation(){return this._separation}set separation(a){return this._separation=a}addNodesToViewport(){super.addNodesToViewport();let a,b=this.rootElement,c=document.createDocumentFragment(),d=document.createTreeWalker(b);for(;a=d.nextNode();){let b=a.cloneNode(),d=a.parentNode;a.rightNode=b,a instanceof HTMLInputElement&&a.addEventListener('change',this._inputSyncHandler),d.rightNode?d.rightNode.appendChild(b):c.appendChild(b)}b.appendChild(c),b.classList.add('vr--stereoscopic'),b.firstElementChild.classList.add('vr__eye--left'),b.lastElementChild.classList.add('vr__eye--right'),b.lastElementChild.setAttribute('aria-hidden','true'),this._mutationObserver=new MutationObserver((a)=>{a.forEach((a)=>{if('attributes'===a.type){let b=a.target,c=a.attributeName;b.rightNode&&b.rightNode.setAttribute(c,b.getAttribute(c))}})}),this._mutationObserver.observe(b,{attributes:!0,childList:!1,characterData:!0,subtree:!0})}removeNodesFromViewport(){let a,b=this.rootElement,c=document.createTreeWalker(b);for(this._mutationObserver.disconnect(),b.removeChild(b.lastElementChild),b.classList.remove('vr--stereoscopic');a=c.nextNode();)a instanceof HTMLInputElement&&a.removeEventListener('change',this._inputSyncHandler),delete a.rightNode;delete this._mutationObserver,super.removeNodesFromViewport()}update(a){let b=this._separation/2,c=0|window.innerWidth/4/g(a.fov/2/180*h),d=`translateZ(${c-c/10}px)`+`rotateZ(${a.rotation.z}deg)`+`rotateX(${a.rotation.x}deg)`+`rotateY(${a.rotation.y}deg)`+`translate3d(${-a.position.x}px,${-a.position.y}px,${-a.position.z}px)`;this.cameraElement.style.transform=d,this.viewportElement.style.perspective=c+'px',this.viewportElement.style.perspectiveOrigin=`calc(50% - ${b}px) 50%`,this.viewportElement.rightNode.style.perspectiveOrigin=`calc(50% + ${b}px) 50%`,this.cursorElement.style.transform=`translate(-${b/2}px, -50%)`,this.cursorElement.rightNode.style.transform=`translate(+${b/2}px, -50%)`}}class x{constructor(){this.rotation=new l}}let y=0,z=0;class A extends x{constructor(){super(),this.mouseDownHandler=b.bind(this),this.mouseMoveHandler=c.bind(this),this.mouseUpHandler=d.bind(this),this.selectStartHandler=e.bind(this)}start(){window.addEventListener('mousedown',this.mouseDownHandler),window.addEventListener('selectstart',this.selectStartHandler)}stop(){window.removeEventListener('mousedown',this.mouseDownHandler),window.removeEventListener('selectstart',this.selectStartHandler)}}const B=(a,b,c)=>{var d=Math.acos;let e=a*m,f=b*m,g=c*m,l=j(e),o=i(e),p=j(f),q=i(f),r=j(g),s=i(g),t=-o*q*r-l*s,u=l*q*r-o*s,v=p*r,w=Math.atan(t/u);0>u?w+=h:0>t&&(w+=2*h);let x=h/2-d(-v),y=k(1-v*v),z=d(-(p*s)/y)*Math.sign(-q);return{heading:w*n-90,elevation:x*n,tilt:z*n}};class C extends x{constructor(){super(),this.handler=f.bind(this)}start(){window.addEventListener('deviceorientation',this.handler)}stop(){window.removeEventListener('deviceorientation',this.handler)}}const D=/@media\s.*?(?=\{)+/g;let E;const F=(a,b,c)=>{let d=new RegExp('(^|,\\s+)'+b+'(?=\\s|$)','g');return a.replace(d,'$1'+c)},G=(a)=>{return a=F(a,'screen','screen-cssvr-disabled'),a=F(a,'cssvr','screen'),a},H=(a)=>{return a=F(a,'screen','cssvr'),a=F(a,'screen-cssvr-disabled','screen'),a},I=(a)=>{return'@media '+G(a.substr(7))},J=(a)=>{return'@media '+H(a.substr(7))},K=(a)=>{return a=a.replace(D,I),a=a.replace(/:hover/g,'.vr__selection'),a},L=(a)=>{return a=a.replace(D,J),a=a.replace(/\.vr__selection/g,':hover'),a},M=(a)=>{return Array.from(document.querySelectorAll(a))},N=(a)=>{a?(!E&&(E=document.createElement('style'),E.textContent='.vr{position:fixed;top:0;left:0;bottom:0;right:0;display:flex}.vr__eye{flex:1;overflow:hidden;position:relative;height:100%}.vr__viewport{height:100%;position:relative}.vr__camera,.vr__cursor{position:absolute;top:50%;left:50%;transform-style:preserve-3d;transform:translate(-50%,-50%)}.vr__cursor{padding:5% 5% 0 0;border:.6vw solid #0c0;border-radius:50%;z-index:1}.vr__cursor--hover{animation:cursor 1s .5s forwards}.vr--stereoscopic .vr__cursor{border-width:.3vw}@keyframes cursor{0%{border-color:#0c0}25%{border-top-color:red;border-right-color:#0c0;border-bottom-color:#0c0;border-left-color:#0c0}50%{border-top-color:red;border-right-color:red;border-bottom-color:#0c0;border-left-color:#0c0}75%{border-top-color:red;border-right-color:red;border-bottom-color:red;border-left-color:#0c0}100%{border-top-color:red;border-right-color:red;border-bottom-color:red;border-left-color:red}}'),document.body.appendChild(E)):E&&E.parentElement.removeChild(E),M('style').forEach((b)=>{b.textContent=a?K(b.textContent):L(b.textContent)}),M('link[rel=stylesheet][media]').forEach((b)=>{b.media=a?G(b.media):H(b.media)})},O=()=>{return N(!0),new Promise((a)=>{requestAnimationFrame(a)})},P=()=>{return N(!1),new Promise((a)=>{requestAnimationFrame(a)})},Q=0,R=2;let S,T,U,V,W,X,Y=Q;const Z=(a,b)=>{let c,d=new WeakMap,e=b.ownerDocument,f=e.createTreeWalker(b,NodeFilter.SHOW_ELEMENT),g=null,h=Number.MAX_VALUE;for(;c=f.nextNode();){let e=s.fromElement(c);d.set(c,{origin:e.origin.clone(),position:e.position.clone(),rotation:e.rotation.clone()});for(let a,f=c.parentElement;f!==b;)a=d.get(f),e.rotate(a.rotation,a.origin),e.translate(a.position),f=f.parentElement;if(e.canInteract){let b=a.getFaceIntersectionDistance(e);b&&b<h&&(h=b,g=c)}}return g},$=()=>{let a=new l(0,0,-1),b=S.position,c=new l(S.rotation.x*-m,S.rotation.y*-m,0);a.rotate(c);let d=new p(b,a),e=Z(d,T.cameraElement);if(!(e&&e===U)){if(U){for(let a=U;a!==T.cameraElement;)a.classList.remove('vr__selection'),a=a.parentElement;T.cursorElement.classList.remove('vr__cursor--hover'),clearTimeout(V)}if(U=e,U){for(let a=U;a!==T.cameraElement;)a.classList.add('vr__selection'),a=a.parentElement;U.hasAttribute('vr-action')&&requestAnimationFrame(()=>{T.cursorElement.classList.add('vr__cursor--hover'),V=setTimeout(()=>{T.cursorElement.classList.remove('vr__cursor--hover'),U.click()},1700)})}}},_=()=>{let a=W.rotation.clone();a.add(X.rotation),S.rotation=a,T.update(S),$()},aa=()=>{Y==R&&(requestAnimationFrame(aa),_())};return a.start=(a={})=>{if(Y!=Q)return Promise.reject();Y=1;let b=a.root||document.body,c=document.documentElement;return c.style.display='none',S=new t,S.fov=a.fov||70,S.position.y=-a.cameraHeight||0,'stereo'===a.projection?(T=new w(b),T.separation=a.stereoPitch):T=new v(b),W=new A,W.start(),X=new C,X.start(),Promise.resolve().then(O).then(()=>T.enable()).then(()=>{Y=R,aa(),c.style.display=''})},a.stop=()=>{if(Y!=R)return Promise.reject();Y=3;let a=document.documentElement;return a.style.display='none',X.stop(),W.stop(),Promise.resolve().then(P).then(()=>T.disable()).then(()=>{a.style.display='',Y=Q})},a}({});